C51 COMPILER V9.57.0.0   MAIN                                                              12/19/2022 21:56:34 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\MCU\Keil5\C51\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listing
                    -s\main.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "LCD1602.h"
   3          #include "DS1302.h"
   4          #include "Delay.h"
   5          #include "key.h"
   6          #include "Timer0.h"
   7          
   8          unsigned char KeyNum, MODE, TimeSetSelect;
   9          //æŒ‰ä¸‹æŒ‰é”®1ï¼Œæ”¹å˜MODE
  10          void TimeShow(void)
  11          {
  12   1              DS1302_ReadTime();
  13   1              LCD_ShowNum(1, 1, DS1302_Time[0], 2);
  14   1              LCD_ShowNum(1, 4, DS1302_Time[1], 2);
  15   1              LCD_ShowNum(1, 7, DS1302_Time[2], 2);
  16   1              LCD_ShowNum(2, 1, DS1302_Time[3], 2);
  17   1              LCD_ShowNum(2, 4, DS1302_Time[4], 2);
  18   1              LCD_ShowNum(2, 7, DS1302_Time[5], 2);   
  19   1      }
  20          
  21          //æŒ‰é”®2ï¼Œè®¾ç½®å¹´æœˆæ—¥æ—¶åˆ†ç§’
  22          void TimeSet(void)
  23          {
  24   1              if(KeyNum == 2) //Feature2: åˆ‡æ¢ å¹´/æœˆ/æ—¥/æ—¶/åˆ†/ç§’ 6ç§å•ç‹¬çš„æ¨¡å¼ï¼Œåˆå§‹åŒ–æŒ‰2æ—¶æ²¡ç”¨
  25   1              {
  26   2                      TimeSetSelect++;
  27   2                      if(TimeSetSelect > 5)   TimeSetSelect = 0; //å¾ªç¯åˆ‡æ¢
  28   2                      //(TimeSetSelect++) %= 6;       //å¦ä¸€ç§åˆ‡æ¢æ–¹å¼ï¼Œè¶Šç•Œæ¸…é›¶
  29   2              }
  30   1              
  31   1              //Feature3: å¹´/æœˆ/æ—¥/æ—¶/åˆ†/ç§’ 6ç§å•ç‹¬æ¨¡å¼çš„åŠ å‡
  32   1              if(KeyNum == 3) //æ—¶é—´+ï¼Œé€šè¿‡æ“ä½œDS1302_Time[]æ•°ç»„æ¥æŒ‡å®šå¹´æœˆæ—¥æ—¶åˆ†ç§’ç§çš„æŸä¸ªå¾€ä¸Šå
             -Š 
  33   1              {
  34   2                      DS1302_Time[TimeSetSelect]++;
  35   2                      /*      å„ä¸ªå•ç‹¬å¢åŠ æ—¶çš„è¶Šç•Œå¤„ç†    */
  36   2                      if(DS1302_Time[0] > 99) { DS1302_Time[0] = 0; } //å¹´è¶…è¿‡99åå›åˆ°0
  37   2                      if(DS1302_Time[1] > 12) { DS1302_Time[1] = 1; } //æœˆè¶…è¿‡12æœˆåå›åˆ°1æœˆ
  38   2                      /*      æ—¥è¶…è¿‡28/29/30/31åå›åˆ°1(åˆ¤æ–­å¹³å¹´ä¸é—°å¹´)   */
  39   2                      if(DS1302_Time[1]==1 || DS1302_Time[1]==3 || DS1302_Time[1]==5 || DS1302_Time[1]==7 
  40   2                              || DS1302_Time[1]==8 || DS1302_Time[1]==10 || DS1302_Time[1]==12)       //ä¸€ä¸‰äº”ä¸ƒå…«åè…Šï¼Œ31å¤©æ°¸ä¸
             -å·®
  41   2                      {
  42   3                              if(DS1302_Time[2] > 31) { DS1302_Time[2] = 1; }
  43   3                      }
  44   2                      else if(DS1302_Time[1]==4 || DS1302_Time[1]==6 || DS1302_Time[1]==9 || DS1302_Time[1]==11)      //4/6/9/11æœˆ
             -30å¤©
  45   2                      {
  46   3                              if(DS1302_Time[2] > 30) { DS1302_Time[2] = 1; }
  47   3                      }
  48   2                      else if(DS1302_Time[1] == 2)
  49   2                      {
  50   3                              if(DS1302_Time[0]%4 == 0)       //é—°å¹´
  51   3                              {
C51 COMPILER V9.57.0.0   MAIN                                                              12/19/2022 21:56:34 PAGE 2   

  52   4                                      if(DS1302_Time[2] > 29) { DS1302_Time[2] = 1; }
  53   4                              }
  54   3                              else    //å¹³å¹´
  55   3                              {
  56   4                                      if(DS1302_Time[2] > 28) { DS1302_Time[2] = 1; }
  57   4                              }
  58   3                      }
  59   2                      if(DS1302_Time[3] > 23) { DS1302_Time[3] = 0; } //æ—¶è¶…è¿‡59åå›åˆ°0
  60   2                      if(DS1302_Time[4] > 59) { DS1302_Time[4] = 0; } //åˆ†è¶…è¿‡59åå›åˆ°0
  61   2                      if(DS1302_Time[5] > 59) { DS1302_Time[5] = 0; } //ç§’è¶…è¿‡59åå›åˆ°0
  62   2              }
  63   1              if(KeyNum == 4) //æ—¶é—´-ï¼Œé€šè¿‡æ“ä½œDS1302_Time[]æ•°ç»„æ¥æŒ‡å®šå¹´æœˆæ—¥æ—¶åˆ†ç§’ç§çš„æŸä¸ªå¾€ä¸‹å
             -‡
  64   1              {
  65   2                      DS1302_Time[TimeSetSelect]--;
  66   2                      /*      å„ä¸ªå•ç‹¬å‡å°æ—¶çš„è¶Šç•Œå¤„ç†    */
  67   2                      if(DS1302_Time[0] < 0)  { DS1302_Time[0] = 99; }        //å¹´ä»0å›åˆ°ä¸Šä¸–çºª99å¹´
  68   2                      if(DS1302_Time[1] < 1)  { DS1302_Time[1] = 12; }        //æœˆä»1æœˆå›åˆ°ä¸Šä¸€å¹´12æœˆ
  69   2                      /*      æ—¥è¶…è¿‡28/29/30/31åå›åˆ°1(åˆ¤æ–­å¹³å¹´ä¸é—°å¹´)   */
  70   2                      if(DS1302_Time[1]==1 || DS1302_Time[1]==3 || DS1302_Time[1]==5 || DS1302_Time[1]==7 
  71   2                              || DS1302_Time[1]==8 || DS1302_Time[1]==10 || DS1302_Time[1]==12)       //ä¸€ä¸‰äº”ä¸ƒå…«åè…Šï¼Œ31å¤©æ°¸ä¸
             -å·®
  72   2                      {
  73   3                              if(DS1302_Time[2] < 1)  { DS1302_Time[2] = 31; }
  74   3                              if(DS1302_Time[2] > 31) { DS1302_Time[2] = 1; }
  75   3                      }
  76   2                      else if(DS1302_Time[1]==4 || DS1302_Time[1]==6 || DS1302_Time[1]==9 || DS1302_Time[1]==11)      //4/6/9/11æœˆ
             -30å¤©
  77   2                      {
  78   3                              if(DS1302_Time[2] < 1)  { DS1302_Time[2] = 30; }
  79   3                              if(DS1302_Time[2] > 30) { DS1302_Time[2] = 1; }
  80   3                      }
  81   2                      else if(DS1302_Time[1] == 2)
  82   2                      {
  83   3                              if(DS1302_Time[0]%4 == 0)       //é—°å¹´
  84   3                              {
  85   4                                      if(DS1302_Time[2] < 1)  { DS1302_Time[2] = 29; }
  86   4                                      if(DS1302_Time[2] > 29) { DS1302_Time[2] = 1; }
  87   4                              }
  88   3                              else    //å¹³å¹´
  89   3                              {
  90   4                                      if(DS1302_Time[2] < 1)  { DS1302_Time[2] = 28; }
  91   4                                      if(DS1302_Time[2] > 28) { DS1302_Time[2] = 1; }
  92   4                              }
  93   3                      }
  94   2                      if(DS1302_Time[3] < 0)  { DS1302_Time[3] = 23; }        //ä»0å›åˆ°23æ—¶
  95   2                      if(DS1302_Time[4] < 0)  { DS1302_Time[4] = 59; }        //ä»0å›åˆ°59åˆ†
  96   2                      if(DS1302_Time[5] < 0)  { DS1302_Time[5] = 59; }        //ä»0å›åˆ°59ç§’
  97   2              }
  98   1              
  99   1              LCD_ShowNum(1, 1, DS1302_Time[0], 2);
 100   1              LCD_ShowNum(1, 4, DS1302_Time[1], 2);
 101   1              LCD_ShowNum(1, 7, DS1302_Time[2], 2);
 102   1              LCD_ShowNum(2, 1, DS1302_Time[3], 2);
 103   1              LCD_ShowNum(2, 4, DS1302_Time[4], 2);
 104   1              LCD_ShowNum(2, 7, DS1302_Time[5], 2);   
 105   1              LCD_ShowNum(2, 10, TimeSetSelect, 2);   //TEST: æµ‹è¯•åˆ‡æ¢çš„æŒ‰é”®
 106   1      }
 107          
 108          void main(void)
 109          {
 110   1              LCD_Init();
C51 COMPILER V9.57.0.0   MAIN                                                              12/19/2022 21:56:34 PAGE 3   

 111   1              DS1302_Init();
 112   1              LCD_ShowString(1, 1, "  -  -  ");
 113   1              LCD_ShowString(2, 1, "  :  :  ");
 114   1              
 115   1              DS1302_SetTime();       //åˆå§‹æ—¶é—´è®¾ç½®
 116   1              
 117   1              while(1)
 118   1              {
 119   2                      KeyNum = key();
 120   2                      if(KeyNum == 1) //Feature1: æŒ‰é”®1è¿æŒ‰äº¤æ›¿æ”¹å˜æŒ‰é”®æ¨¡å¼
 121   2                      {
 122   3                              if(MODE == 0)   {       MODE = 1;       }
 123   3                              else if(MODE == 1)      {       MODE = 0;       }
 124   3                      }
 125   2                      switch(MODE)    //äº¤æ›¿è°ƒç”¨ä¸¤ä¸ªå‡½æ•°:åˆå§‹å€¼ä¸º0ï¼Œæ˜¾ç¤ºæ—¶é—´ï¼Œå½“æŒ‰ä¸‹æŒ‰é”®æ—¶ï¼Œæ¨¡å¼æ”¹ä¸º
             -1ï¼Œæ—¶é—´åœæ­¢ï¼Œå¯ä»¥è®¾ç½®æ—¶é—´
 126   2                      {
 127   3                              case 0: TimeShow(); break;
 128   3                              case 1: TimeSet();      break;
 129   3                      }
 130   2              }
 131   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    772    ----
   CONSTANT SIZE    =     18    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
