C51 COMPILER V9.57.0.0   MAIN                                                              12/19/2022 22:30:23 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\MCU\Keil5\C51\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listing
                    -s\main.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "LCD1602.h"
   3          #include "DS1302.h"
   4          #include "Delay.h"
   5          #include "key.h"
   6          #include "Timer0.h"
   7          
   8          unsigned char KeyNum, MODE, TimeSetSelect, TimeSetFlashFlag;//Êó∂Èó¥ËÆæÁΩÆÈó™ÁÉÅÊ†áÂøó‰Ωç
   9          //Êåâ‰∏ãÊåâÈîÆ1ÔºåÊîπÂèòMODE
  10          void TimeShow(void)
  11          {
  12   1              DS1302_ReadTime();
  13   1              LCD_ShowNum(1, 1, DS1302_Time[0], 2);
  14   1              LCD_ShowNum(1, 4, DS1302_Time[1], 2);
  15   1              LCD_ShowNum(1, 7, DS1302_Time[2], 2);
  16   1              LCD_ShowNum(2, 1, DS1302_Time[3], 2);
  17   1              LCD_ShowNum(2, 4, DS1302_Time[4], 2);
  18   1              LCD_ShowNum(2, 7, DS1302_Time[5], 2);   
  19   1      }
  20          
  21          //ÊåâÈîÆ2ÔºåËÆæÁΩÆÂπ¥ÊúàÊó•Êó∂ÂàÜÁßíÂπ∂Â≠òÂÇ®Âú®DS1302_Time[]Êï∞ÁªÑ‰∏≠
  22          void TimeSet(void)
  23          {
  24   1              if(KeyNum == 2) //Feature2: ÂàáÊç¢ Âπ¥/Êúà/Êó•/Êó∂/ÂàÜ/Áßí 6ÁßçÂçïÁã¨ÁöÑÊ®°ÂºèÔºåÂàùÂßãÂåñÊåâ2Êó∂Ê≤°Áî®
  25   1              {
  26   2                      TimeSetSelect++;
  27   2                      if(TimeSetSelect > 5)   TimeSetSelect = 0; //Âæ™ÁéØÂàáÊç¢
  28   2                      //(TimeSetSelect++) %= 6;       //Âè¶‰∏ÄÁßçÂàáÊç¢ÊñπÂºèÔºåË∂äÁïåÊ∏ÖÈõ∂
  29   2              }
  30   1              
  31   1              //Feature3: Âπ¥/Êúà/Êó•/Êó∂/ÂàÜ/Áßí 6ÁßçÂçïÁã¨Ê®°ÂºèÁöÑÂä†Âáè
  32   1              if(KeyNum == 3) //Êó∂Èó¥+ÔºåÈÄöËøáÊìç‰ΩúDS1302_Time[]Êï∞ÁªÑÊù•ÊåáÂÆöÂπ¥ÊúàÊó•Êó∂ÂàÜÁßíÁßçÁöÑÊüê‰∏™ÂæÄ‰∏äÂ
             -ä†
  33   1              {
  34   2                      DS1302_Time[TimeSetSelect]++;
  35   2                      /*      ÂêÑ‰∏™ÂçïÁã¨Â¢ûÂä†Êó∂ÁöÑË∂äÁïåÂ§ÑÁêÜ    */
  36   2                      if(DS1302_Time[0] > 99) { DS1302_Time[0] = 0; } //Âπ¥Ë∂ÖËøá99ÂêéÂõûÂà∞0
  37   2                      if(DS1302_Time[1] > 12) { DS1302_Time[1] = 1; } //ÊúàË∂ÖËøá12ÊúàÂêéÂõûÂà∞1Êúà
  38   2                      /*      Êó•Ë∂ÖËøá28/29/30/31ÂêéÂõûÂà∞1(Âà§Êñ≠Âπ≥Âπ¥‰∏éÈó∞Âπ¥)   */
  39   2                      if(DS1302_Time[1]==1 || DS1302_Time[1]==3 || DS1302_Time[1]==5 || DS1302_Time[1]==7 
  40   2                              || DS1302_Time[1]==8 || DS1302_Time[1]==10 || DS1302_Time[1]==12)       //‰∏Ä‰∏â‰∫î‰∏ÉÂÖ´ÂçÅËÖäÔºå31Â§©Ê∞∏‰∏ç
             -Â∑Æ
  41   2                      {
  42   3                              if(DS1302_Time[2] > 31) { DS1302_Time[2] = 1; }
  43   3                      }
  44   2                      else if(DS1302_Time[1]==4 || DS1302_Time[1]==6 || DS1302_Time[1]==9 || DS1302_Time[1]==11)      //4/6/9/11Êúà
             -30Â§©
  45   2                      {
  46   3                              if(DS1302_Time[2] > 30) { DS1302_Time[2] = 1; }
  47   3                      }
  48   2                      else if(DS1302_Time[1] == 2)
  49   2                      {
  50   3                              if(DS1302_Time[0]%4 == 0)       //Èó∞Âπ¥
  51   3                              {
C51 COMPILER V9.57.0.0   MAIN                                                              12/19/2022 22:30:23 PAGE 2   

  52   4                                      if(DS1302_Time[2] > 29) { DS1302_Time[2] = 1; }
  53   4                              }
  54   3                              else    //Âπ≥Âπ¥
  55   3                              {
  56   4                                      if(DS1302_Time[2] > 28) { DS1302_Time[2] = 1; }
  57   4                              }
  58   3                      }
  59   2                      if(DS1302_Time[3] > 23) { DS1302_Time[3] = 0; } //Êó∂Ë∂ÖËøá59ÂêéÂõûÂà∞0
  60   2                      if(DS1302_Time[4] > 59) { DS1302_Time[4] = 0; } //ÂàÜË∂ÖËøá59ÂêéÂõûÂà∞0
  61   2                      if(DS1302_Time[5] > 59) { DS1302_Time[5] = 0; } //ÁßíË∂ÖËøá59ÂêéÂõûÂà∞0
  62   2              }
  63   1              if(KeyNum == 4) //Êó∂Èó¥-ÔºåÈÄöËøáÊìç‰ΩúDS1302_Time[]Êï∞ÁªÑÊù•ÊåáÂÆöÂπ¥ÊúàÊó•Êó∂ÂàÜÁßíÁßçÁöÑÊüê‰∏™ÂæÄ‰∏ãÂ
             -áè
  64   1              {
  65   2                      DS1302_Time[TimeSetSelect]--;
  66   2                      /*      ÂêÑ‰∏™ÂçïÁã¨ÂáèÂ∞èÊó∂ÁöÑË∂äÁïåÂ§ÑÁêÜ    */
  67   2                      if(DS1302_Time[0] < 0)  { DS1302_Time[0] = 99; }        //Âπ¥‰ªé0ÂõûÂà∞‰∏ä‰∏ñÁ∫™99Âπ¥
  68   2                      if(DS1302_Time[1] < 1)  { DS1302_Time[1] = 12; }        //Êúà‰ªé1ÊúàÂõûÂà∞‰∏ä‰∏ÄÂπ¥12Êúà
  69   2                      /*      Êó•Ë∂ÖËøá28/29/30/31ÂêéÂõûÂà∞1(Âà§Êñ≠Âπ≥Âπ¥‰∏éÈó∞Âπ¥)   */
  70   2                      if(DS1302_Time[1]==1 || DS1302_Time[1]==3 || DS1302_Time[1]==5 || DS1302_Time[1]==7 
  71   2                              || DS1302_Time[1]==8 || DS1302_Time[1]==10 || DS1302_Time[1]==12)       //‰∏Ä‰∏â‰∫î‰∏ÉÂÖ´ÂçÅËÖäÔºå31Â§©Ê∞∏‰∏ç
             -Â∑Æ
  72   2                      {
  73   3                              if(DS1302_Time[2] < 1)  { DS1302_Time[2] = 31; }
  74   3                              if(DS1302_Time[2] > 31) { DS1302_Time[2] = 1; } //Note:Â∫îÂØπÊó•Ë∞ÉÂà∞31Êó∂ÔºåÊúàË∞ÉÊï¥Âà∞Â∞è‰∫é31Â§©Áö
             -ÑÊúàÊó∂ÁöÑ‰∏çÂêàÁêÜÈóÆÈ¢òÔºåÂ¶Ç12-31(OK)->11-31(ERR)
  75   3                      }
  76   2                      else if(DS1302_Time[1]==4 || DS1302_Time[1]==6 || DS1302_Time[1]==9 || DS1302_Time[1]==11)      //4/6/9/11Êúà
             -30Â§©
  77   2                      {
  78   3                              if(DS1302_Time[2] < 1)  { DS1302_Time[2] = 30; }
  79   3                              if(DS1302_Time[2] > 30) { DS1302_Time[2] = 1; }
  80   3                      }
  81   2                      else if(DS1302_Time[1] == 2)
  82   2                      {
  83   3                              if(DS1302_Time[0]%4 == 0)       //Èó∞Âπ¥
  84   3                              {
  85   4                                      if(DS1302_Time[2] < 1)  { DS1302_Time[2] = 29; }
  86   4                                      if(DS1302_Time[2] > 29) { DS1302_Time[2] = 1; }
  87   4                              }
  88   3                              else    //Âπ≥Âπ¥
  89   3                              {
  90   4                                      if(DS1302_Time[2] < 1)  { DS1302_Time[2] = 28; }
  91   4                                      if(DS1302_Time[2] > 28) { DS1302_Time[2] = 1; }
  92   4                              }
  93   3                      }
  94   2                      if(DS1302_Time[3] < 0)  { DS1302_Time[3] = 23; }        //‰ªé0ÂõûÂà∞23Êó∂
  95   2                      if(DS1302_Time[4] < 0)  { DS1302_Time[4] = 59; }        //‰ªé0ÂõûÂà∞59ÂàÜ
  96   2                      if(DS1302_Time[5] < 0)  { DS1302_Time[5] = 59; }        //‰ªé0ÂõûÂà∞59Áßí
  97   2              }
  98   1              // TimeSetFlashFlagÊØèÈöî0.5sÂèñ‰∏ÄÊ¨°ÂèçÔºå‰∏ãÊñπÊù°‰ª∂‰πüÊòØÈó¥Èöî0.5sÈó™ÁÉÅ‰∏ÄÊ¨°
  99   1              if(TimeSetSelect == 0 && TimeSetFlashFlag == 1) { LCD_ShowString(1, 1, "  ");   }
 100   1              else {  LCD_ShowNum(1, 1, DS1302_Time[0], 2);   }
 101   1              if(TimeSetSelect == 1 && TimeSetFlashFlag == 1) { LCD_ShowString(1, 4, "  ");   }
 102   1              else {  LCD_ShowNum(1, 4, DS1302_Time[1], 2);   }
 103   1              if(TimeSetSelect == 2 && TimeSetFlashFlag == 1) { LCD_ShowString(1, 7, "  ");   }
 104   1              else {  LCD_ShowNum(1, 7, DS1302_Time[2], 2);   }
 105   1              if(TimeSetSelect == 3 && TimeSetFlashFlag == 1) { LCD_ShowString(2, 1, "  ");   }
 106   1              else {  LCD_ShowNum(2, 1, DS1302_Time[3], 2);   }
 107   1              if(TimeSetSelect == 4 && TimeSetFlashFlag == 1) { LCD_ShowString(2, 4, "  ");   }
 108   1              else {  LCD_ShowNum(2, 4, DS1302_Time[4], 2);   }
 109   1              if(TimeSetSelect == 5 && TimeSetFlashFlag == 1) { LCD_ShowString(2, 7, "  ");   }
C51 COMPILER V9.57.0.0   MAIN                                                              12/19/2022 22:30:23 PAGE 3   

 110   1              else {  LCD_ShowNum(2, 7, DS1302_Time[5], 2);   }
 111   1              
 112   1              //LCD_ShowNum(2, 10, TimeSetSelect, 2); //TEST: ÊµãËØïÂàáÊç¢ÁöÑÊåâÈîÆ
 113   1              //LCD_ShowNum(2, 13, TimeSetFlashFlag, 1);      //TEST: ÊµãËØïÊó∂Èó¥ËÆæÁΩÆÈó™ÁÉÅÊ†áÂøó‰Ωç
 114   1      }
 115          
 116          void main(void)
 117          {
 118   1              LCD_Init();
 119   1              DS1302_Init();
 120   1              Timer0_Init();
 121   1              LCD_ShowString(1, 1, "  -  -  ");
 122   1              LCD_ShowString(2, 1, "  :  :  ");
 123   1              
 124   1              DS1302_SetTime();       //ÂàùÂßãÊó∂Èó¥ËÆæÁΩÆ
 125   1              
 126   1              while(1)
 127   1              {
 128   2                      KeyNum = key();
 129   2                      if(KeyNum == 1) //Feature1: ÊåâÈîÆ1ËøûÊåâ‰∫§ÊõøÊîπÂèòÊåâÈîÆÊ®°Âºè
 130   2                      {
 131   3                              if(MODE == 0)   {       MODE = 1;       }
 132   3                              else if(MODE == 1)      {       MODE = 0; DS1302_SetTime();     }       //Feature4: ÂàáÊç¢ÂõûÊ®°Âºè0ÊòæÁ§∫Êó∂Èó¥Êó∂Ôºå‰ªéÊï∞
             -ÁªÑ‰∏≠ËØªÂèñÂΩìÂâçÊï∞ÁªÑ‰∏≠ÁöÑÊó∂Èó¥
 133   3                      }
 134   2                      switch(MODE)    //‰∫§ÊõøË∞ÉÁî®‰∏§‰∏™ÂáΩÊï∞:ÂàùÂßãÂÄº‰∏∫0ÔºåÊòæÁ§∫Êó∂Èó¥ÔºåÂΩìÊåâ‰∏ãÊåâÈîÆÊó∂ÔºåÊ®°ÂºèÊîπ‰∏∫
             -1ÔºåÊó∂Èó¥ÂÅúÊ≠¢ÔºåÂèØ‰ª•ËÆæÁΩÆÊó∂Èó¥
 135   2                      {
 136   3                              case 0: TimeShow(); break;
 137   3                              case 1: TimeSet();      break;
 138   3                      }
 139   2              }
 140   1      }
 141          
 142          void Timer0_Routine(void) interrupt 1   //ÂÆöÊó∂Âô®/ËÆ°Êï∞Âô®ÂàùÂßãÂåñÂáΩÊï∞
 143          {
 144   1              static unsigned int cnt;
 145   1              TL0 = 0x66;             //ËÆæÁΩÆÂÆöÊó∂ÂàùÂÄº
 146   1              TH0 = 0xFC;             //ËÆæÁΩÆÂÆöÊó∂ÂàùÂÄº
 147   1              cnt++;
 148   1              if(cnt >= 500)
 149   1              {
 150   2                      cnt = 0;
 151   2                      TimeSetFlashFlag = !TimeSetFlashFlag;   //0/1
 152   2              }
 153   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    968    ----
   CONSTANT SIZE    =     21    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
